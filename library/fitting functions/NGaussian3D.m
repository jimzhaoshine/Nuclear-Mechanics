function [ I ] = NGaussian3D( p,x,y,z )
%calculate image intensity for N guassian particles in 3D
% p, cx,cy,cz,sigmaxy,sigmaz,brightness
num=size(p,1);
I=zeros(size(x));
for i=1:num
%     dist2=-((x-p(i,1)).^2+(y-p(i,2)).^2)/p(i,4)^2-(z-p(i,3)).^2/p(i,5)^2;
%     tmp=zeros(size(x));
%     tmp(dist2>-5)=exp(dist2);
%         I=I + p(i,6)*tmp;
    I=I + p(i,6)*...
        exp(-((x-p(i,1)).^2+(y-p(i,2)).^2)/p(i,4)^2-(z-p(i,3)).^2/p(i,5)^2);
end

end

